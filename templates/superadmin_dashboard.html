{% extends "base.html" %}
{% block title %}Super Admin{% endblock %}
{% block content %}
<h3>Super Admin Dashboard</h3>

<h5 class="mt-3">All Users</h5>
<table class="table table-striped datatable">
  <thead class="table-dark"><tr><th>User ID</th><th>Name</th><th>Type</th><th>City</th><th>WhatsApp</th><th>Promo</th><th>Actions</th></tr></thead>
  <tbody>
    {% for u in users %}
    <tr>
      <td>{{ u.user_id }}</td><td>{{ u.name }}</td><td>{{ u.user_type }}</td><td>{{ u.city }}</td><td>{{ u.whatsapp }}</td><td>{{ u.default_promo }}</td>
      <td>
        <a class="btn btn-sm btn-warning" href="{{ url_for('edit', user_id=u.user_id) }}">Edit</a>
        <a class="btn btn-sm btn-danger" href="{{ url_for('delete', user_id=u.user_id) }}" onclick="return confirm('Delete user?');">Delete</a>
        <a class="btn btn-sm btn-success" href="{{ url_for('download_qr', user_id=u.user_id) }}">QR</a>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<h5 class="mt-4">All Transactions</h5>
<table class="table table-striped datatable">
  <thead class="table-primary"><tr><th>Customer</th><th>Shop</th><th>Bill</th><th>Promo</th><th>Date</th></tr></thead>
  <tbody>
    {% for t in transactions %}
    <tr>
      <td>{{ t.customer_id }}</td><td>{{ t.shop_id }}</td><td>{{ t.bill_amount }}</td>
      <td style="color: {{ 'green' if t.promotion_amount>100 else 'blue' }}">{{ t.promotion_amount }}</td>
      <td>{{ t.transaction_date }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<h5 class="mt-4">Shop Summary</h5>
<table class="table table-sm">
  <thead><tr><th>Shop ID</th><th>#Txns</th><th>Total Sales</th><th>Total Promo</th></tr></thead>
  <tbody>
    {% for s in shop_stats %}
    <tr><td>{{ s[0] }}</td><td>{{ s[1] }}</td><td>{{ s[2] }}</td><td>{{ s[3] }}</td></tr>
    {% endfor %}
  </tbody>
</table>

<h5 class="mt-4">Customer Summary</h5>
<table class="table table-sm">
  <thead><tr><th>Customer ID</th><th>#Txns</th><th>Total Spent</th><th>Total Promo</th></tr></thead>
  <tbody>
    {% for c in cust_stats %}
    <tr><td>{{ c[0] }}</td><td>{{ c[1] }}</td><td>{{ c[2] }}</td><td>{{ c[3] }}</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
